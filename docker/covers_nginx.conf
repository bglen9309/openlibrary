server {
      #listen 80;
      #listen 443;
      listen [::]:443 ssl http2 ipv6only=on;
      listen 443 ssl http2;
      server_name  covers.openlibrary.org;

      #include /run/secrets/petabox_seed;
      root /openlibrary;

      keepalive_timeout 5;

      ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;

      location / {
        proxy_pass http://covers:7075;
        proxy_set_header Host $http_host;

        # Gunicorn takes IP from this header
        proxy_set_header X-Forwarded-For $remote_addr;

        # Hack to make the app pick the right url scheme even when the
        # app server is http only.
        proxy_set_header X-Scheme $scheme;
      }

      location ~ ^(/images/.*|favicon.ico|robots.txt)$ {
        rewrite ^(.*)$ /static/$1 last;
      }

      location ~ ^/(y_key_[0-9a-f]+.html|google[0-9a-f]+.html|LiveSearchSiteAuth.xml)$ {
        root /olsystem/www;
      }

      location /static {
        autoindex on;
        expires 1h;
      }

      location /static/build {
        expires max;
      }

      location /static/sitemaps {
        root /sitemaps;
      }
}
